<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>B树与B&#43;树 - H2oLo</title><meta name="Description" content="cheysen的个人博客"><meta property="og:title" content="B树与B&#43;树" />
<meta property="og:description" content="多路查找树(m-way search tree) 多路查找树是一种用来高效搜索或检索数据的数据结构。m表示最大子节点数。如二叉树也叫2-way查找树。多路查找树主要" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://heysen.xyz/b%E6%A0%91%E4%B8%8Eb-%E6%A0%91/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-04-09T15:11:15+08:00" />
<meta property="article:modified_time" content="2025-04-09T15:11:15+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="B树与B&#43;树"/>
<meta name="twitter:description" content="多路查找树(m-way search tree) 多路查找树是一种用来高效搜索或检索数据的数据结构。m表示最大子节点数。如二叉树也叫2-way查找树。多路查找树主要"/>
<meta name="application-name" content="H2oLo">
<meta name="apple-mobile-web-app-title" content="H2oLo"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://heysen.xyz/b%E6%A0%91%E4%B8%8Eb-%E6%A0%91/" /><link rel="prev" href="https://heysen.xyz/java%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/" /><link rel="next" href="https://heysen.xyz/java%E6%B3%9B%E5%9E%8B/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "B树与B+树",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/heysen.xyz\/b%E6%A0%91%E4%B8%8Eb-%E6%A0%91\/"
        },"genre": "posts","keywords": "树","wordcount":  7682 ,
        "url": "https:\/\/heysen.xyz\/b%E6%A0%91%E4%B8%8Eb-%E6%A0%91\/","datePublished": "2025-04-09T15:11:15+08:00","dateModified": "2025-04-09T15:11:15+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": " "
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="H2oLo"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/hydrogen.png"
        data-srcset="/images/hydrogen.png, /images/hydrogen.png 1.5x, /images/hydrogen.png 2x"
        data-sizes="auto"
        alt="/images/hydrogen.png"
        title="/images/hydrogen.png" /><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="H2oLo"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/hydrogen.png"
        data-srcset="/images/hydrogen.png, /images/hydrogen.png 1.5x, /images/hydrogen.png 2x"
        data-sizes="auto"
        alt="/images/hydrogen.png"
        title="/images/hydrogen.png" /><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">B树与B&#43;树</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-category"><a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><i class="far fa-folder fa-fw"></i>数据结构</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2025-04-09">2025-04-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 7682 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 16 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#多路查找树m-way-search-tree">多路查找树(m-way search tree)</a></li>
    <li><a href="#b树b-tree">B树（B-tree）</a>
      <ul>
        <li><a href="#插入">插入</a></li>
        <li><a href="#删除">删除</a>
          <ul>
            <li><a href="#目标key在叶子节点">目标key在叶子节点</a></li>
            <li><a href="#目标key在内部节点">目标key在内部节点</a></li>
            <li><a href="#高度减少">高度减少</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#b树">B+树</a>
      <ul>
        <li><a href="#插入-1">插入</a></li>
        <li><a href="#删除-1">删除</a>
          <ul>
            <li><a href="#key仅在叶子节点">key仅在叶子节点</a></li>
            <li><a href="#key存在于内部节点和叶子节点">key存在于内部节点和叶子节点</a></li>
            <li><a href="#高度减少-1">高度减少</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="多路查找树m-way-search-tree">多路查找树(m-way search tree)</h1>
<p>多路查找树是一种用来高效搜索或检索数据的数据结构。m表示最大子节点数。如二叉树也叫2-way查找树。多路查找树主要用来优化搜索(因为树高度更小、每个节点存储的key更多)，最优时间复杂度为O($\log_mn$)。</p>
<ul>
<li>最大子节点数为m</li>
<li>节点最大元素数为m-1</li>
<li>最大元素数$m^(h+1)-1$,h为树的高度,这里高度定义为树中任一节点到根节点的路径最大值</li>
<li>最优时间复杂度为O($\log_mn$),这可以通过使用不同的平衡策略可以达到,如B树：除根节点外的其他非叶子节点最少有m/2个子节点;最差时间复杂度0(n)</li>
<li>元素升序排列:左子树值小于根节点,右子树值大于根节点。具体来说：前i个子节点的值均小于第i个key的值;后m-i个子节点的值均大于第i个key的值</li>
</ul>
<p>以下面的5路查找树为例:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/%e5%a4%9a%e8%b7%af%e6%9f%a5%e6%89%be%e6%a0%91.drawio.png"
        data-srcset="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%91.drawio.png, /images/Btree/%e5%a4%9a%e8%b7%af%e6%9f%a5%e6%89%be%e6%a0%91.drawio.png 1.5x, /images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%91.drawio.png 2x"
        data-sizes="auto"
        alt="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%91.drawio.png"
        title="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%91.drawio.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MultiwaySearchTree</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TreeNode</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">val</span><span class="o">;</span>
        <span class="c1">//左子节点
</span><span class="c1"></span>        <span class="kd">public</span> <span class="n">TreeNode</span> <span class="n">left</span><span class="o">;</span>
        <span class="c1">//右子节点
</span><span class="c1"></span>        <span class="kd">public</span> <span class="n">TreeNode</span> <span class="n">right</span><span class="o">;</span>
        <span class="c1">//下一个节点
</span><span class="c1"></span>        <span class="kd">public</span> <span class="n">TreeNode</span> <span class="n">next</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">TreeNode</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">,</span> <span class="n">TreeNode</span> <span class="n">right</span><span class="o">,</span> <span class="n">TreeNode</span> <span class="n">left</span><span class="o">,</span> <span class="n">TreeNode</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nf">TreeNode</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">&#34;TreeNode{&#34;</span> <span class="o">+</span>
                    <span class="s">&#34;val=&#34;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span>
                    <span class="s">&#34;, left=&#34;</span> <span class="o">+</span> <span class="n">left</span> <span class="o">+</span>
                    <span class="s">&#34;, right=&#34;</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span>
                    <span class="s">&#34;, next=&#34;</span> <span class="o">+</span> <span class="n">next</span> <span class="o">+</span>
                    <span class="sc">&#39;}&#39;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">TreeNode</span> <span class="nf">search</span><span class="o">(</span><span class="n">TreeNode</span> <span class="n">root</span><span class="o">,</span> <span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">root</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">val</span> <span class="o">==</span> <span class="n">val</span><span class="o">)</span> <span class="k">return</span> <span class="n">root</span><span class="o">;</span>
        <span class="c1">//如果查找值小于当前节点值,以当前节点的左子节点为根继续查找
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">val</span> <span class="o">&gt;</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">left</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">search</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">//如果查找值大于当前节点值且当前节点没有后续节点,以当前节点的右子节点为根继续查找
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">next</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">right</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">search</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">val</span> <span class="o">==</span> <span class="n">val</span><span class="o">)</span> <span class="k">return</span> <span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
        <span class="c1">//如果查找值介于当前节点值和当前节点的下一节点值之间,则以当前节点的右子节点为根继续查找
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">val</span> <span class="o">&lt;</span> <span class="n">val</span><span class="o">)</span> <span class="k">return</span> <span class="n">search</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
        <span class="c1">//如果查找值大于当前节点和当前节点的下一节点值,则以当前节点的下一节点为根继续查找
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">search</span><span class="o">(</span><span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">val</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">TreeNode</span> <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">18</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">54</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">86</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">400</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">450</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">470</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">7</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">9</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">25</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">35</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">40</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">45</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">19</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">20</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">21</span><span class="o">);</span>
        <span class="n">root</span><span class="o">.</span><span class="na">right</span><span class="o">.</span><span class="na">left</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="o">(</span><span class="n">22</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">search</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="n">40</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><p>可能以上代码例子还不太直观，不能体现一个节点可以有多个key，下面再看一个例子。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/%e5%a4%9a%e8%b7%af%e6%9f%a5%e6%89%be%e6%a0%912.png"
        data-srcset="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%912.png, /images/Btree/%e5%a4%9a%e8%b7%af%e6%9f%a5%e6%89%be%e6%a0%912.png 1.5x, /images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%912.png 2x"
        data-sizes="auto"
        alt="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%912.png"
        title="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%912.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/%e5%a4%9a%e8%b7%af%e6%9f%a5%e6%89%be%e6%a0%913.png"
        data-srcset="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%913.png, /images/Btree/%e5%a4%9a%e8%b7%af%e6%9f%a5%e6%89%be%e6%a0%913.png 1.5x, /images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%913.png 2x"
        data-sizes="auto"
        alt="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%913.png"
        title="/images/Btree/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%913.png" /></p>
<p>相应的数据结构可以表示为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Node</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">count</span><span class="o">;</span><span class="c1">//子节点数
</span><span class="c1"></span>	<span class="kt">int</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">3</span><span class="o">];</span>
	<span class="n">Node</span><span class="o">[]</span> <span class="n">child</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">[</span><span class="n">4</span><span class="o">];</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="b树b-tree">B树（B-tree）</h1>
<p>B树是一种特殊的多路查找树(B树也是平衡版的二叉树)：B树是自平衡的多路查找树数据结构，能以对数时间搜索，访问，插入和删除元素。B树适用于读写相对大的数据块的存储系统，例如磁盘。B树减少定位记录时所经历的中间过程，从而加快访问速度。B树这种数据结构可以用来描述外部存储。这种数据结构常被应用在数据库和文件系统的实现上。</p>
<p>B树相较于多路查找树有以下两个特性：</p>
<ul>
<li>自平衡：每个叶子节点深度相同</li>
<li>除了根节点的节点的元素在[ceil(m/2),m-1]之间(也有说是[m/2-1,m-1])，根节点的元素个数在[1,m-1]之间</li>
<li>如果根节点不是叶子节点，那么它至少有两个子节点（2-3树是最简单的B树）；内部节点最少有ceil(m/2)个子节点</li>
</ul>
<p>插入、删除和搜索操作时间复杂度为O($logn$)，n为树中存储key的个数。另外其空间复杂度为O(n)。</p>
<blockquote>
<p>辅助存储设备通常容量大但读写慢，因此需要像B树这样的数据结构来减少磁盘访问。其他的数据结构像二叉查找树，avl树，红黑树等的每个节点仅存储一个值，如果需要存储大量值，树都高度将会变大导致访问时间增加。</p>
<p>B树能在一个节点存储多个值并且有多个子节点，这减少了树都高度，从而让磁盘访问更快。</p>
</blockquote>
<h2 id="插入">插入</h2>
<p>插入过程如下:</p>
<ul>
<li>1.如果树为空,构建一个根节点并插入值</li>
<li>2.寻找合适的节点插入(符合B树特性的节点)</li>
<li>3.如果节点没有多余的位置，按以下步骤执行：
<ul>
<li>3.1按升序排列插入元素</li>
<li>3.2当前节点已超过最大key数量限制,按中间值分裂</li>
<li>3.3向上弹出中间值,中间值左边的值作为左子节点,中间值右边的值作为右子节点</li>
<li>3.4如果上层节点的值未满,则按升序插入到上层节点</li>
<li>3.5如果上层节点的值已满,重复步骤3</li>
</ul>
</li>
</ul>
<p>例:构建一个B树，M=3，值为12,23,6,8,15,19,45,1,4,7,5。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B%e6%a0%91%e6%8f%92%e5%85%a52.drawio.png"
        data-srcset="/images/Btree/B%E6%A0%91%E6%8F%92%E5%85%A52.drawio.png, /images/Btree/B%e6%a0%91%e6%8f%92%e5%85%a52.drawio.png 1.5x, /images/Btree/B%E6%A0%91%E6%8F%92%E5%85%A52.drawio.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B%E6%A0%91%E6%8F%92%E5%85%A52.drawio.png"
        title="/images/Btree/B%E6%A0%91%E6%8F%92%E5%85%A52.drawio.png" /></p>
<h2 id="删除">删除</h2>
<h3 id="目标key在叶子节点">目标key在叶子节点</h3>
<ul>
<li>
<p>1.1叶子节点key数量大于最小key数量</p>
<ul>
<li>1.1.1直接删除目标key</li>
</ul>
</li>
<li>
<p>1.2叶子节点只有最小数量key</p>
<ul>
<li>1.2.1从当前左兄弟节点借一个最大key(仅当左兄弟节点key数量大于最小值),将该key移到父节点,将父节点key移到目标节点以替换要删除的目标key。如无法执行上述动作，执行1.2.2</li>
<li>1.2.2从当前右兄弟节点借一个最小key(仅当右兄弟节点key数量大于最小值),将该key移到父节点,将父节点key移到目标节点以替换要删除的目标key。如无法执行上述动作，执行1.2.3</li>
<li>1.2.3与左兄弟节点和父节点key合并或者与右兄弟节点和父节点key合并,然后删除目标key</li>
</ul>
</li>
</ul>
<p>以M=5的一颗B树来演示上述步骤：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B%e6%a0%91%e5%88%a0%e9%99%a4-%e5%8f%b6%e5%ad%90%e8%8a%82%e7%82%b9.drawio.png"
        data-srcset="/images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9.drawio.png, /images/Btree/B%e6%a0%91%e5%88%a0%e9%99%a4-%e5%8f%b6%e5%ad%90%e8%8a%82%e7%82%b9.drawio.png 1.5x, /images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9.drawio.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9.drawio.png"
        title="&#39; &amp;lsquo;" /></p>
<h3 id="目标key在内部节点">目标key在内部节点</h3>
<ul>
<li>2.1有序前驱(左子树最大元素)
<ul>
<li>2.1.1找到左子树中最大key代替要删除的目标key。左子树元素数量要大于节点最小元素数量</li>
</ul>
</li>
<li>2.2有序后继(右子树最小元素)
<ul>
<li>2.2.1找到右子树中最小key代替要删除的目标key。右子树元素数量要大于节点最小元素数量</li>
</ul>
</li>
<li>2.3上述都不满足,合并左右子节点和目标key,然后删除目标key</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B%e6%a0%91%e5%88%a0%e9%99%a4-%e5%86%85%e9%83%a8%e8%8a%82%e7%82%b9.drawio.png"
        data-srcset="/images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%86%85%E9%83%A8%E8%8A%82%E7%82%B9.drawio.png, /images/Btree/B%e6%a0%91%e5%88%a0%e9%99%a4-%e5%86%85%e9%83%a8%e8%8a%82%e7%82%b9.drawio.png 1.5x, /images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%86%85%E9%83%A8%E8%8A%82%E7%82%B9.drawio.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%86%85%E9%83%A8%E8%8A%82%E7%82%B9.drawio.png"
        title="/images/Btree/B%E6%A0%91%E5%88%A0%E9%99%A4-%E5%86%85%E9%83%A8%E8%8A%82%E7%82%B9.drawio.png" /></p>
<h3 id="高度减少">高度减少</h3>
<p>无法从左右子树取值时，合并导致高度减少。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B%e6%a0%91%e9%ab%98%e5%ba%a6%e5%87%8f%e5%b0%91.drawio.png"
        data-srcset="/images/Btree/B%E6%A0%91%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.drawio.png, /images/Btree/B%e6%a0%91%e9%ab%98%e5%ba%a6%e5%87%8f%e5%b0%91.drawio.png 1.5x, /images/Btree/B%E6%A0%91%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.drawio.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B%E6%A0%91%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.drawio.png"
        title="/images/Btree/B%E6%A0%91%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.drawio.png" /></p>
<p>以下Java代码来自<a href="https://github.com/phishman3579/java-algorithms-implementation/blob/master/src/com/jwetherell/algorithms/data_structures/BTree.java" target="_blank" rel="noopener noreffer">java-algorithms-implementation仓库</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span><span class="lnt">670
</span><span class="lnt">671
</span><span class="lnt">672
</span><span class="lnt">673
</span><span class="lnt">674
</span><span class="lnt">675
</span><span class="lnt">676
</span><span class="lnt">677
</span><span class="lnt">678
</span><span class="lnt">679
</span><span class="lnt">680
</span><span class="lnt">681
</span><span class="lnt">682
</span><span class="lnt">683
</span><span class="lnt">684
</span><span class="lnt">685
</span><span class="lnt">686
</span><span class="lnt">687
</span><span class="lnt">688
</span><span class="lnt">689
</span><span class="lnt">690
</span><span class="lnt">691
</span><span class="lnt">692
</span><span class="lnt">693
</span><span class="lnt">694
</span><span class="lnt">695
</span><span class="lnt">696
</span><span class="lnt">697
</span><span class="lnt">698
</span><span class="lnt">699
</span><span class="lnt">700
</span><span class="lnt">701
</span><span class="lnt">702
</span><span class="lnt">703
</span><span class="lnt">704
</span><span class="lnt">705
</span><span class="lnt">706
</span><span class="lnt">707
</span><span class="lnt">708
</span><span class="lnt">709
</span><span class="lnt">710
</span><span class="lnt">711
</span><span class="lnt">712
</span><span class="lnt">713
</span><span class="lnt">714
</span><span class="lnt">715
</span><span class="lnt">716
</span><span class="lnt">717
</span><span class="lnt">718
</span><span class="lnt">719
</span><span class="lnt">720
</span><span class="lnt">721
</span><span class="lnt">722
</span><span class="lnt">723
</span><span class="lnt">724
</span><span class="lnt">725
</span><span class="lnt">726
</span><span class="lnt">727
</span><span class="lnt">728
</span><span class="lnt">729
</span><span class="lnt">730
</span><span class="lnt">731
</span><span class="lnt">732
</span><span class="lnt">733
</span><span class="lnt">734
</span><span class="lnt">735
</span><span class="lnt">736
</span><span class="lnt">737
</span><span class="lnt">738
</span><span class="lnt">739
</span><span class="lnt">740
</span><span class="lnt">741
</span><span class="lnt">742
</span><span class="lnt">743
</span><span class="lnt">744
</span><span class="lnt">745
</span><span class="lnt">746
</span><span class="lnt">747
</span><span class="lnt">748
</span><span class="lnt">749
</span><span class="lnt">750
</span><span class="lnt">751
</span><span class="lnt">752
</span><span class="lnt">753
</span><span class="lnt">754
</span><span class="lnt">755
</span><span class="lnt">756
</span><span class="lnt">757
</span><span class="lnt">758
</span><span class="lnt">759
</span><span class="lnt">760
</span><span class="lnt">761
</span><span class="lnt">762
</span><span class="lnt">763
</span><span class="lnt">764
</span><span class="lnt">765
</span><span class="lnt">766
</span><span class="lnt">767
</span><span class="lnt">768
</span><span class="lnt">769
</span><span class="lnt">770
</span><span class="lnt">771
</span><span class="lnt">772
</span><span class="lnt">773
</span><span class="lnt">774
</span><span class="lnt">775
</span><span class="lnt">776
</span><span class="lnt">777
</span><span class="lnt">778
</span><span class="lnt">779
</span><span class="lnt">780
</span><span class="lnt">781
</span><span class="lnt">782
</span><span class="lnt">783
</span><span class="lnt">784
</span><span class="lnt">785
</span><span class="lnt">786
</span><span class="lnt">787
</span><span class="lnt">788
</span><span class="lnt">789
</span><span class="lnt">790
</span><span class="lnt">791
</span><span class="lnt">792
</span><span class="lnt">793
</span><span class="lnt">794
</span><span class="lnt">795
</span><span class="lnt">796
</span><span class="lnt">797
</span><span class="lnt">798
</span><span class="lnt">799
</span><span class="lnt">800
</span><span class="lnt">801
</span><span class="lnt">802
</span><span class="lnt">803
</span><span class="lnt">804
</span><span class="lnt">805
</span><span class="lnt">806
</span><span class="lnt">807
</span><span class="lnt">808
</span><span class="lnt">809
</span><span class="lnt">810
</span><span class="lnt">811
</span><span class="lnt">812
</span><span class="lnt">813
</span><span class="lnt">814
</span><span class="lnt">815
</span><span class="lnt">816
</span><span class="lnt">817
</span><span class="lnt">818
</span><span class="lnt">819
</span><span class="lnt">820
</span><span class="lnt">821
</span><span class="lnt">822
</span><span class="lnt">823
</span><span class="lnt">824
</span><span class="lnt">825
</span><span class="lnt">826
</span><span class="lnt">827
</span><span class="lnt">828
</span><span class="lnt">829
</span><span class="lnt">830
</span><span class="lnt">831
</span><span class="lnt">832
</span><span class="lnt">833
</span><span class="lnt">834
</span><span class="lnt">835
</span><span class="lnt">836
</span><span class="lnt">837
</span><span class="lnt">838
</span><span class="lnt">839
</span><span class="lnt">840
</span><span class="lnt">841
</span><span class="lnt">842
</span><span class="lnt">843
</span><span class="lnt">844
</span><span class="lnt">845
</span><span class="lnt">846
</span><span class="lnt">847
</span><span class="lnt">848
</span><span class="lnt">849
</span><span class="lnt">850
</span><span class="lnt">851
</span><span class="lnt">852
</span><span class="lnt">853
</span><span class="lnt">854
</span><span class="lnt">855
</span><span class="lnt">856
</span><span class="lnt">857
</span><span class="lnt">858
</span><span class="lnt">859
</span><span class="lnt">860
</span><span class="lnt">861
</span><span class="lnt">862
</span><span class="lnt">863
</span><span class="lnt">864
</span><span class="lnt">865
</span><span class="lnt">866
</span><span class="lnt">867
</span><span class="lnt">868
</span><span class="lnt">869
</span><span class="lnt">870
</span><span class="lnt">871
</span><span class="lnt">872
</span><span class="lnt">873
</span><span class="lnt">874
</span><span class="lnt">875
</span><span class="lnt">876
</span><span class="lnt">877
</span><span class="lnt">878
</span><span class="lnt">879
</span><span class="lnt">880
</span><span class="lnt">881
</span><span class="lnt">882
</span><span class="lnt">883
</span><span class="lnt">884
</span><span class="lnt">885
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">datastructure</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author cheysen
</span><span class="cm"> * @date 2025/4/3 12:36
</span><span class="cm"> * @description B 树是一种树数据结构，它使数据保持排序并允许对数时间的搜索、顺序访问、插入和删除。
</span><span class="cm"> * B 树是二叉搜索树的泛化，因为一个节点可以有两个以上的子节点。与自平衡二叉搜索树不同，B 树针对读取和写入大型数据块的系统进行了优化。它通常用于数据库和文件系统。
</span><span class="cm"> **/</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BTree</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="kd">implements</span> <span class="n">Tree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">//2-3树是最简单的B树:最大key数量2,最大子节点数3,最小key数量2
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">minKeySize</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">minChildrenSize</span> <span class="o">=</span> <span class="n">minKeySize</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">maxKeySize</span> <span class="o">=</span> <span class="n">2</span> <span class="o">*</span> <span class="n">minKeySize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">maxChildrenSize</span> <span class="o">=</span> <span class="n">maxKeySize</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>

    <span class="c1">//默认2-3树
</span><span class="c1"></span>    <span class="kd">public</span> <span class="nf">BTree</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="c1">//order:非根节点最少key数量
</span><span class="c1"></span>    <span class="kd">public</span> <span class="nf">BTree</span><span class="o">(</span><span class="kt">int</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">minKeySize</span> <span class="o">=</span> <span class="n">order</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">minChildrenSize</span> <span class="o">=</span> <span class="n">minKeySize</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">maxKeySize</span> <span class="o">=</span> <span class="n">2</span> <span class="o">*</span> <span class="n">minKeySize</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">maxChildrenSize</span> <span class="o">=</span> <span class="n">maxKeySize</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BTree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">appendAdd</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">added</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">added</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&#34;add &#34;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&#34; error&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">root</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="n">maxKeySize</span><span class="o">,</span> <span class="n">maxChildrenSize</span><span class="o">);</span>
            <span class="n">root</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">root</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//没有子节点就在当前节点插入
</span><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="n">maxKeySize</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="c1">//key数量已满，需要分裂
</span><span class="c1"></span>                    <span class="n">split</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">//否则，按有序的规则查找该插入的节点
</span><span class="c1"></span>                <span class="n">T</span> <span class="n">lesser</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">lesser</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
                    <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kt">int</span> <span class="n">numberOfKeys</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">last</span> <span class="o">=</span> <span class="n">numberOfKeys</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
                <span class="n">T</span> <span class="n">greater</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">last</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">greater</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">numberOfKeys</span><span class="o">);</span>
                    <span class="k">continue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">T</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
                    <span class="n">T</span> <span class="n">next</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">prev</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">next</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">size</span><span class="o">++;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">remove</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">T</span> <span class="n">removed</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getNode</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="n">remove</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">node</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">removed</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">getNode</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">root</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">validate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">root</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">validateNode</span><span class="o">(</span><span class="n">root</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">toCollection</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JavaCompatibleBTree</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">TreePrinter</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 获取目标值所在节点
</span><span class="cm">     * @param value 要查找的值
</span><span class="cm">     * @return 目标值所在节点
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getNode</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">root</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">node</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//尝试是否比节点最小值小
</span><span class="c1"></span>            <span class="n">T</span> <span class="n">lesser</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">lesser</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">continue</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">//尝试是否比节点最大值大
</span><span class="c1"></span>            <span class="kt">int</span> <span class="n">numberOfKeys</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">lastIndex</span> <span class="o">=</span> <span class="n">numberOfKeys</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
            <span class="n">T</span> <span class="n">greater</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">lastIndex</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">greater</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">numberOfKeys</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">numberOfKeys</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">continue</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">//不满足极大极小情况,在中间值中比较
</span><span class="c1"></span>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfKeys</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">T</span> <span class="n">currentValue</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">currentValue</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">node</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kt">int</span> <span class="n">next</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">next</span> <span class="o">&lt;=</span> <span class="n">lastIndex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">T</span> <span class="n">nextValue</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
                    <span class="c1">//目标值介于第i与第i+1个key之间时,在第i+1个子节点(如果有)中继续查找
</span><span class="c1"></span>                    <span class="k">if</span> <span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">currentValue</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">nextValue</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">next</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">())</span> <span class="o">{</span>
                            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">next</span><span class="o">);</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 从节点中删除值
</span><span class="cm">     * @param value 要删除的值
</span><span class="cm">     * @param node 要删除的值所在节点
</span><span class="cm">     * @return true-删除成功
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">T</span> <span class="nf">remove</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">,</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">T</span> <span class="n">removed</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
        <span class="c1">//叶子节点元素的删除:1.直接删除 2.兄弟节点借值 3.合并兄弟节点(之一)与父节点key
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">combined</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//只有一个元素根节点删除,清空树
</span><span class="c1"></span>                <span class="n">root</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//内部节点元素的删除:1.有序前驱值替换 2.有序后继值替换 3.合并目标值的左右子节点
</span><span class="c1"></span>            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">lesser</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
            <span class="c1">//找到最大有序前驱
</span><span class="c1"></span>            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">greatestNode</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getGreatestNode</span><span class="o">(</span><span class="n">lesser</span><span class="o">);</span>
            <span class="n">T</span> <span class="n">replaceValue</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">removeGreatestValue</span><span class="o">(</span><span class="n">greatestNode</span><span class="o">);</span>
            <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">replaceValue</span><span class="o">);</span>
            <span class="c1">//借最大有序前驱相当于在子节点中删除一个最大值
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">greatestNode</span><span class="o">.</span><span class="na">parent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">greatestNode</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">combined</span><span class="o">(</span><span class="n">greatestNode</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">//combined中不需考虑分裂的情况:借值不用考虑;合并只在左右兄弟节点key数量等于minKeySize时,合并后最大为maxKeySize
</span><span class="c1"></span>            <span class="c1">//而这里是先借值,再合并,如果是借最有序前驱,假如右兄弟节点有maxKeySize,合并后就需要分裂
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">greatestNode</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">maxChildrenSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="n">greatestNode</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">size</span><span class="o">--;</span>
        <span class="k">return</span> <span class="n">removed</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/** 当节点key数量不足最小数量时组合父节点和子节点key.组合包括向兄弟节点借值和合并两种情况
</span><span class="cm">     * @param node 组合的子节点
</span><span class="cm">     * @return true-组合成功
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">combined</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">parent</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">indexOfParentChild</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">indexOfLeftNeighbor</span> <span class="o">=</span> <span class="n">indexOfParentChild</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">indexOfRightNeighbor</span> <span class="o">=</span> <span class="n">indexOfParentChild</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">rightNeighbor</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">//这里只是初始化
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">rightNeighborSize</span> <span class="o">=</span> <span class="o">-</span><span class="n">minChildrenSize</span><span class="o">;</span>
        <span class="c1">//如果有右兄弟节点
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">indexOfRightNeighbor</span> <span class="o">&lt;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">rightNeighbor</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">indexOfRightNeighbor</span><span class="o">);</span>
            <span class="n">rightNeighborSize</span> <span class="o">=</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//尝试向兄弟节点借值(左右顺序没有先后)
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">rightNeighbor</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">rightNeighborSize</span> <span class="o">&gt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//右兄弟节点的最小值
</span><span class="c1"></span>            <span class="n">T</span> <span class="n">removeValue</span> <span class="o">=</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="c1">//父节点中有序前驱(相对于给定值而言)的索引
</span><span class="c1"></span>            <span class="kt">int</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">getIndexOfPreviousValue</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">removeValue</span><span class="o">);</span>
            <span class="n">T</span> <span class="n">parentValue</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">prev</span><span class="o">);</span>
            <span class="n">T</span> <span class="n">neighborValue</span> <span class="o">=</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
            <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">parentValue</span><span class="o">);</span>
            <span class="n">parent</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">neighborValue</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">rightNeighbor</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">node</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">rightNeighbor</span><span class="o">.</span><span class="na">removeChild</span><span class="o">(</span><span class="n">0</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">leftNeighbor</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">leftNeighborSize</span> <span class="o">=</span> <span class="o">-</span><span class="n">minChildrenSize</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">indexOfLeftNeighbor</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">leftNeighbor</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">indexOfLeftNeighbor</span><span class="o">);</span>
                <span class="n">leftNeighborSize</span> <span class="o">=</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">leftNeighbor</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">leftNeighborSize</span> <span class="o">&gt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//左兄弟节点的最大值
</span><span class="c1"></span>                <span class="n">T</span> <span class="n">removeValue</span> <span class="o">=</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">leftNeighbor</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">nextV</span> <span class="o">=</span> <span class="n">getIndexOfNextValue</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">removeValue</span><span class="o">);</span>
                <span class="n">T</span> <span class="n">parentValue</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">nextV</span><span class="o">);</span>
                <span class="n">T</span> <span class="n">neighborValue</span> <span class="o">=</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">leftNeighbor</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
                <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">parentValue</span><span class="o">);</span>
                <span class="n">parent</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">neighborValue</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">leftNeighbor</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">leftNeighbor</span><span class="o">.</span><span class="na">removeChild</span><span class="o">(</span><span class="n">leftNeighbor</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">));</span>
                <span class="o">}</span>

            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">rightNeighbor</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//不能借值,尝试与右兄弟节点合并(左右顺序没有先后)
</span><span class="c1"></span>                <span class="n">T</span> <span class="n">removeValue</span> <span class="o">=</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">getIndexOfPreviousValue</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">removeValue</span><span class="o">);</span>
                <span class="n">T</span> <span class="n">parentValue</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">prev</span><span class="o">);</span>
                <span class="n">parent</span><span class="o">.</span><span class="na">removeChild</span><span class="o">(</span><span class="n">rightNeighbor</span><span class="o">);</span>
                <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">parentValue</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">keySize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">T</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="c1">//非叶子节点合并需要考虑
</span><span class="c1"></span>                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">rightNeighbor</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">parent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">//合并使得父节点key数量不足最小数量,继续向上合并
</span><span class="c1"></span>                    <span class="k">this</span><span class="o">.</span><span class="na">combined</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">//合并使得父节点没有key,树都高度减少
</span><span class="c1"></span>                    <span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">node</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">leftNeighbor</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">T</span> <span class="n">removeValue</span> <span class="o">=</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">leftNeighbor</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">nextV</span> <span class="o">=</span> <span class="n">getIndexOfNextValue</span><span class="o">(</span><span class="n">parent</span><span class="o">,</span> <span class="n">removeValue</span><span class="o">);</span>
                <span class="n">T</span> <span class="n">parentValue</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">nextV</span><span class="o">);</span>
                <span class="n">parent</span><span class="o">.</span><span class="na">removeChild</span><span class="o">(</span><span class="n">leftNeighbor</span><span class="o">);</span>
                <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">parentValue</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">keySize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">T</span> <span class="n">v</span> <span class="o">=</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">leftNeighbor</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">parent</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">combined</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="n">node</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 节点key数量大于最大key数量，从中间分裂
</span><span class="cm">     * @param nodeToSplit 要分裂的节点
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">split</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">nodeToSplit</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodeToSplit</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">numberOfKeys</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">medianIndex</span> <span class="o">=</span> <span class="n">numberOfKeys</span> <span class="o">/</span> <span class="n">2</span><span class="o">;</span><span class="c1">//向下取整
</span><span class="c1"></span>        <span class="n">T</span> <span class="n">medianValue</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">medianIndex</span><span class="o">);</span>

        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="n">maxKeySize</span><span class="o">,</span> <span class="n">maxChildrenSize</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">medianIndex</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">left</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="c1">//如果中间值是第i个key,那么前i个子节点归为分裂出的左节点的子节点
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">medianIndex</span> <span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="n">left</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="n">maxKeySize</span><span class="o">,</span> <span class="n">maxChildrenSize</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">medianIndex</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfKeys</span> <span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">right</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="c1">//如果中间值是第i个key,那么后m-i个子节点归为分裂出的右节点的子节点
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">medianIndex</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="n">right</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//将中间值向上弹出至父节点
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//如果是根节点的分裂,树的高度增加
</span><span class="c1"></span>            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">newRoot</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="n">maxKeySize</span><span class="o">,</span> <span class="n">maxChildrenSize</span><span class="o">);</span>
            <span class="n">newRoot</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">medianValue</span><span class="o">);</span>
            <span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="n">newRoot</span><span class="o">;</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">newRoot</span><span class="o">;</span>
            <span class="n">root</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">left</span><span class="o">);</span>
            <span class="n">root</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">right</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">parent</span><span class="o">;</span>
            <span class="n">parent</span><span class="o">.</span><span class="na">addKey</span><span class="o">(</span><span class="n">medianValue</span><span class="o">);</span>
            <span class="n">parent</span><span class="o">.</span><span class="na">removeChild</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
            <span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">left</span><span class="o">);</span>
            <span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">right</span><span class="o">);</span>
            <span class="c1">//如果父节点key数量已满,则继续分裂
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">maxKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">split</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在节点中找第一个小于给定值的值的索引
</span><span class="cm">     * @param node
</span><span class="cm">     * @param value
</span><span class="cm">     * @return 有序前驱的索引 | -1
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">getIndexOfPreviousValue</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">,</span> <span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//只有1个值时,直接返回了
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 在节点中第一个大于给定值的索引
</span><span class="cm">     * @param node
</span><span class="cm">     * @param value
</span><span class="cm">     * @return 有序后继的索引 | -1
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">getIndexOfNextValue</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">,</span> <span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 找到给定节点树下的最大(最右)节点
</span><span class="cm">     * @param nodeToGet
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getGreatestNode</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">nodeToGet</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">nodeToGet</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 删除节点中的最大值
</span><span class="cm">     * @param node
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">T</span> <span class="nf">removeGreatestValue</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">T</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">removeKey</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * 以给定节点为根节点验证B树是否合法
</span><span class="cm">     * @param node 
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">validateNode</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">keySize</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">keySize</span> <span class="o">&gt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//验证元素是否升序
</span><span class="c1"></span>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">keySize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">T</span> <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
                <span class="n">T</span> <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="kt">int</span> <span class="n">childrenSize</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">parent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//根节点
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">keySize</span> <span class="o">&gt;</span> <span class="n">maxKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//根节点没有最小元素限制，空树也视为合法
</span><span class="c1"></span>                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">&lt;</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//2-3树是最简单的B树
</span><span class="c1"></span>                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">&gt;</span> <span class="n">maxChildrenSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//非根节点
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">keySize</span> <span class="o">&lt;</span> <span class="n">minKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">keySize</span> <span class="o">&gt;</span> <span class="n">maxKeySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">keySize</span> <span class="o">!=</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">-</span> <span class="n">1</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">//key数量可以由子节点树推导，但子节点树不一定是keySize+1
</span><span class="c1"></span>                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">&gt;</span> <span class="n">maxChildrenSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">&lt;</span> <span class="n">minChildrenSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//第一个子节点的有序性
</span><span class="c1"></span>        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">first</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">))</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//最后一个子节点的有序性
</span><span class="c1"></span>        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">last</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">last</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">))</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//中间节点的有序性
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">T</span> <span class="n">p</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
            <span class="n">T</span> <span class="n">n</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">))</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">))</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//递归向下验证
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="kt">boolean</span> <span class="n">valid</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">validateNode</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">valid</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">T</span><span class="o">[]</span> <span class="n">keys</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">keySize</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;[]</span> <span class="n">children</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">childrenSize</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="kd">private</span> <span class="nf">Node</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">parent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxKeySize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxChildrenSize</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">;</span>
            <span class="c1">//+1是为了应对分裂
</span><span class="c1"></span>            <span class="k">this</span><span class="o">.</span><span class="na">keys</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">[])</span><span class="k">new</span> <span class="n">Comparable</span><span class="o">[</span><span class="n">maxKeySize</span> <span class="o">+</span> <span class="n">1</span><span class="o">];</span>
            <span class="k">this</span><span class="o">.</span><span class="na">children</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">[</span><span class="n">maxChildrenSize</span> <span class="o">+</span> <span class="n">1</span><span class="o">];</span>
            <span class="k">this</span><span class="o">.</span><span class="na">keySize</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">childrenSize</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>


        <span class="kd">private</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">comparator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//TODO 这里该如何定义?
</span><span class="c1"></span>                <span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o2</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">0</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">};</span>


        <span class="kd">private</span> <span class="n">T</span> <span class="nf">getKey</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">keys</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">indexOf</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">keySize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addKey</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//不使用排序
</span><span class="c1"></span>            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
            <span class="cm">/*通过向后复制来实现插入,如[11,15,20,0,0]插入17
</span><span class="cm">              [11,15,20,20,0] -&gt; [11,15,17,20,0]
</span><span class="cm">             */</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">keySize</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span><span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
                <span class="n">keys</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="n">keys</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="n">keySize</span><span class="o">++;</span>
            <span class="c1">//使用排序
</span><span class="c1"></span>            <span class="cm">/*
</span><span class="cm">             keys[keysSize++] = value;
</span><span class="cm">             Arrays.sort(keys, 0, keysSize);
</span><span class="cm">             */</span>
        <span class="o">}</span>

        <span class="c1">//此方法只考虑节点内部元素的删除
</span><span class="c1"></span>        <span class="kd">private</span> <span class="n">T</span> <span class="nf">removeKey</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">T</span> <span class="n">removed</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">keySize</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">keySize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="n">removed</span> <span class="o">=</span> <span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">found</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">//向前复制删除,第一次循环不会进入这段逻辑,所以i-1&gt;0
</span><span class="c1"></span>                    <span class="n">keys</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span><span class="n">1</span> <span class="o">]</span> <span class="o">=</span> <span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="c1">//删除相当于整体向前移一位
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">found</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">keySize</span><span class="o">--;</span>
                <span class="n">keys</span><span class="o">[</span><span class="n">keySize</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">//此方法只考虑节点内部元素的删除
</span><span class="c1"></span>        <span class="kd">private</span> <span class="n">T</span> <span class="nf">removeKey</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">keySize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">T</span> <span class="n">value</span> <span class="o">=</span> <span class="n">keys</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">keySize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">keys</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">keys</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="n">keySize</span><span class="o">--;</span>
            <span class="n">keys</span><span class="o">[</span><span class="n">keySize</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">numberOfKeys</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">keySize</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">numberOfChildren</span><span class="o">()</span> <span class="o">{</span><span class="k">return</span> <span class="n">childrenSize</span><span class="o">;}</span>

        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getChild</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">childrenSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">children</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">indexOf</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">child</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">children</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">child</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">addChild</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">child</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">child</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="n">children</span><span class="o">[</span><span class="n">childrenSize</span><span class="o">++]</span> <span class="o">=</span> <span class="n">child</span><span class="o">;</span>
            <span class="n">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">children</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">childrenSize</span><span class="o">,</span> <span class="n">comparator</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">removeChild</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">child</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">childrenSize</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">found</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">children</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="n">child</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">found</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">children</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">children</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">found</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">childrenSize</span><span class="o">--;</span>
                <span class="n">children</span><span class="o">[</span><span class="n">childrenSize</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">found</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">removeChild</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">childrenSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">value</span> <span class="o">=</span> <span class="n">children</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
            <span class="n">children</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">children</span><span class="o">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">children</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="n">childrenSize</span><span class="o">--;</span>
            <span class="n">children</span><span class="o">[</span><span class="n">childrenSize</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;keys=[&#34;</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">T</span> <span class="n">value</span> <span class="o">=</span> <span class="n">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;, &#34;</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;]\n&#34;</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;parent=[&#34;</span><span class="o">);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">T</span> <span class="n">value</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">parent</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;, &#34;</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;, &#34;</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">children</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;keySize=&#34;</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">numberOfKeys</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34; children=[&#34;</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">numberOfChildren</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;\n&#34;</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">JavaCompatibleBTree</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="n">AbstractCollection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="n">BTree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">JavaCompatibleBTree</span><span class="o">(</span><span class="n">BTree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">tree</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="na">remove</span><span class="o">((</span><span class="n">T</span><span class="o">)</span> <span class="n">value</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="na">contains</span><span class="o">((</span><span class="n">T</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">BTreeIterator</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">.</span><span class="na">tree</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">BTreeIterator</span><span class="o">&lt;</span><span class="n">C</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">{</span>

            <span class="kd">private</span> <span class="n">BTree</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">tree</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kd">private</span> <span class="n">BTree</span><span class="o">.</span><span class="na">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">lastNode</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kd">private</span> <span class="n">C</span> <span class="n">lastValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
            <span class="kd">private</span> <span class="n">Deque</span><span class="o">&lt;</span><span class="n">BTree</span><span class="o">.</span><span class="na">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="n">toVisit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayDeque</span><span class="o">&lt;&gt;();</span>


            <span class="kd">public</span> <span class="nf">BTreeIterator</span><span class="o">(</span><span class="n">BTree</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">tree</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">root</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">tree</span><span class="o">.</span><span class="na">root</span><span class="o">.</span><span class="na">keySize</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">toVisit</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">root</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">((</span><span class="n">lastNode</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">lastNode</span><span class="o">.</span><span class="na">keySize</span><span class="o">)</span> <span class="o">||</span> <span class="n">toVisit</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">C</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">lastNode</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">lastNode</span><span class="o">.</span><span class="na">keySize</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">lastValue</span> <span class="o">=</span> <span class="n">lastNode</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">index</span><span class="o">++);</span>
                    <span class="k">return</span> <span class="n">lastValue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">toVisit</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="n">toVisit</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">.</span><span class="na">childrenSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="n">toVisit</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">n</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
                    <span class="o">}</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
                    <span class="n">lastNode</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span>
                    <span class="n">lastValue</span> <span class="o">=</span> <span class="n">lastNode</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">index</span><span class="o">++);</span>
                    <span class="k">return</span> <span class="n">lastValue</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">lastNode</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">lastValue</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">//删除时，重置迭代器（效率很低）
</span><span class="c1"></span>                    <span class="n">tree</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">lastValue</span><span class="o">,</span> <span class="n">lastNode</span><span class="o">);</span>

                    <span class="n">lastNode</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="n">lastValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
                    <span class="n">toVisit</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">root</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">tree</span><span class="o">.</span><span class="na">root</span><span class="o">.</span><span class="na">keySize</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">toVisit</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">root</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TreePrinter</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">String</span> <span class="nf">getString</span><span class="o">(</span><span class="n">BTree</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">tree</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">root</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">&#34;Tree is empty&#34;</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">getString</span><span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">root</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">String</span> <span class="nf">getString</span><span class="o">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">node</span><span class="o">,</span> <span class="n">String</span> <span class="n">prefix</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isTail</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">prefix</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">isTail</span> <span class="o">?</span> <span class="s">&#34;└── &#34;</span> <span class="o">:</span> <span class="s">&#34;├── &#34;</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">T</span> <span class="n">value</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getKey</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfKeys</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;, &#34;</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;\n&#34;</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">children</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                    <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="o">(</span><span class="n">isTail</span> <span class="o">?</span> <span class="s">&#34;   &#34;</span> <span class="o">:</span> <span class="s">&#34;|   &#34;</span><span class="o">),</span> <span class="kc">false</span><span class="o">));</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">&gt;=</span><span class="n">1</span> <span class="o">)</span> <span class="o">{</span>
                    <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">getChild</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">numberOfChildren</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
                    <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="o">(</span><span class="n">isTail</span> <span class="o">?</span> <span class="s">&#34;   &#34;</span> <span class="o">:</span> <span class="s">&#34;|   &#34;</span><span class="o">),</span> <span class="kc">true</span><span class="o">));</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">BTree</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">tbTree</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BTree</span><span class="o">&lt;&gt;(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">12</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">23</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">6</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">8</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">15</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">19</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">45</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">7</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tbTree</span><span class="o">);</span>
        <span class="n">tbTree</span><span class="o">.</span><span class="na">toCollection</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>

        <span class="n">BTree</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fiveWay</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BTree</span><span class="o">&lt;&gt;(</span><span class="n">2</span><span class="o">);</span>
        <span class="n">fiveWay</span><span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">78</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">22</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">75</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">89</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">94</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">10</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">12</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">23</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">31</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">76</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">77</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">86</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">87</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">88</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">90</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">93</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">98</span><span class="o">)</span>
                <span class="o">.</span><span class="na">appendAdd</span><span class="o">(</span><span class="n">99</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fiveWay</span><span class="o">);</span>
        <span class="n">fiveWay</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">22</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fiveWay</span><span class="o">);</span>
        <span class="n">fiveWay</span><span class="o">.</span><span class="na">toCollection</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="b树">B+树</h1>
<p>B+树是B树的变体，针对读取大量数据（例如数据库和文件系统）的系统进行了优化。由于在管理大量数据时有更少的I/O次数，所以B+树广泛应用于数据库索引。</p>
<ul>
<li>所有的数据存储在叶子节点，内部节点只存储key：这些key用于将搜索引导到存储实际数据值的适当叶子节点中</li>
<li>叶子节点存储key和数据，这些叶子节点互相链接，高效执行范围查询和顺序查询</li>
</ul>
<p>B树和B+树都差异如下表(表中&quot;节点包含数据&quot;在数据库系统中通常意味着指向数据记录的指针)：</p>
<table>
<thead>
<tr>
<th>B树</th>
<th>B+树</th>
</tr>
</thead>
<tbody>
<tr>
<td>每个节点包含key和数据</td>
<td>内部节点仅包含key,叶子节点包含key和数据</td>
</tr>
<tr>
<td>\</td>
<td>叶子节点以链表形式链接</td>
</tr>
<tr>
<td>随机访问更快</td>
<td>范围查询更快,允许顺序访问</td>
</tr>
<tr>
<td>内部节点存储数据降低空间利用率</td>
<td>节点可以存储更多的key,更高效</td>
</tr>
<tr>
<td>无重复的key</td>
<td>key可以重复,内部节点出现的key也存在于叶子节点</td>
</tr>
<tr>
<td>高度更高</td>
<td>高度更小,意味着I/O次数更少</td>
</tr>
</tbody>
</table>
<h2 id="插入-1">插入</h2>
<p>B+树都插入根B树类似,需要注意以下两点</p>
<ul>
<li>内部节点分裂时,key不重复</li>
<li>子节点分裂时,分裂的中间值在右子节点重复</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B&#43;%e6%a0%91%e6%8f%92%e5%85%a5.drawio.png"
        data-srcset="/images/Btree/B&#43;%E6%A0%91%E6%8F%92%E5%85%A5.drawio.png, /images/Btree/B&#43;%e6%a0%91%e6%8f%92%e5%85%a5.drawio.png 1.5x, /images/Btree/B&#43;%E6%A0%91%E6%8F%92%E5%85%A5.drawio.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B&#43;%E6%A0%91%E6%8F%92%E5%85%A5.drawio.png"
        title="/images/Btree/B&#43;%E6%A0%91%E6%8F%92%E5%85%A5.drawio.png" /></p>
<h2 id="删除-1">删除</h2>
<h3 id="key仅在叶子节点">key仅在叶子节点</h3>
<p><strong>节点key数量大于最小key数量</strong></p>
<p>直接删除</p>
<p><strong>节点只有最小key数量</strong></p>
<p>删除该key，从直接兄弟节点借一个key，将兄弟节点的中间key移到父节点</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a45.png"
        data-srcset="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A45.png, /images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a45.png 1.5x, /images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A45.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A45.png"
        title="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A45.png" /></p>
<h3 id="key存在于内部节点和叶子节点">key存在于内部节点和叶子节点</h3>
<p><strong>key数量大于最小key数量</strong></p>
<p>直接删除内部节点和叶子节点的key，用有序后继填充内部节点删除的位置</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a445.png"
        data-srcset="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A445.png, /images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a445.png 1.5x, /images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A445.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A445.png"
        title="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A445.png" /></p>
<p><strong>只有最小key数量且key所在位置相邻</strong></p>
<p>删除该key,从直接兄弟节点借一个值，填充内部节点删除的位置</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a435.png"
        data-srcset="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A435.png, /images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a435.png 1.5x, /images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A435.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A435.png"
        title="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A435.png" /></p>
<p><strong>只有最小key数量且key所在位置不相邻</strong></p>
<p>删除该key,合并兄弟节点，用有序后续填充内部节点删除的位置</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a425.png"
        data-srcset="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A425.png, /images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a425.png 1.5x, /images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A425.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A425.png"
        title="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A425.png" /></p>
<h3 id="高度减少-1">高度减少</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a4%e9%ab%98%e5%ba%a6%e5%87%8f%e5%b0%91.png"
        data-srcset="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A4%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.png, /images/Btree/B&#43;%e6%a0%91%e5%88%a0%e9%99%a4%e9%ab%98%e5%ba%a6%e5%87%8f%e5%b0%91.png 1.5x, /images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A4%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.png 2x"
        data-sizes="auto"
        alt="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A4%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.png"
        title="/images/Btree/B&#43;%E6%A0%91%E5%88%A0%E9%99%A4%E9%AB%98%E5%BA%A6%E5%87%8F%E5%B0%91.png" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2025-04-09</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/b%E6%A0%91%E4%B8%8Eb-%E6%A0%91/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E6%A0%91/">树</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/java%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/" class="prev" rel="prev" title="Java枚举类型介绍和使用"><i class="fas fa-angle-left fa-fw"></i>Java枚举类型介绍和使用</a>
            <a href="/java%E6%B3%9B%E5%9E%8B/" class="next" rel="next" title="Java中的泛型">Java中的泛型<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">H2oLo</div><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2025</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="https://beian.miit.gov.cn/" target="_blank">湘ICP备19007912号</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"data":{"id-1":"H2oLo","id-2":"H2oLo"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
